# Pop データ コメント機能 現状仕様

最終更新日: 2025-08-07

## 概要

Pop データのコメント機能は、レコード店員がお客様向けのメモや推薦コメントを残すためのシンプルなテキスト機能です。

## 現在の仕様

### データ構造
- **型**: `string`（文字列）
- **デフォルト値**: 空文字 `""`
- **保存場所**: Pop データの `comment` プロパティ
- **必須入力**: なし（空でもOK）

### 入力仕様（CreatePopModal.tsx）
- **UI コンポーネント**: `<Textarea>`
- **最大文字数**: **200文字**
- **表示行数**: **3行**
- **改行**: **可能**
- **プレースホルダー**: `"このレコードについてのコメント...（改行可能）"`
- **バリデーション**: 
  - 文字数制限のみ（200文字）
  - リアルタイム文字数カウンター表示（例: `150/200文字`）

```typescript
// 入力処理の実装
<Textarea
  id='comment'
  value={formData.comment}
  onChange={(e) =>
    setFormData((prev) => ({ ...prev, comment: e.target.value }))
  }
  placeholder='このレコードについてのコメント...（改行可能）'
  rows={3}
  maxLength={200}
  disabled={isLoading}
  autoComplete='off'
/>
```

### 表示仕様（PopCard.tsx）
- **条件付き表示**: コメントが存在する場合のみ表示
- **改行処理**: `split("\n")` で分割後、`<br />` で改行を再現
- **スタイリング**: `bg-muted p-2 rounded mb-2`（薄いグレー背景、角丸、パディング）
- **表示場所**: Pop カード内の下部（価格表示の後、バッジ表示の前）

```typescript
// 表示処理の実装
{pop.comment && (
  <div className='text-xs bg-muted p-2 rounded mb-2'>
    {pop.comment.split("\n").map((line, index) => (
      <div key={index}>
        {line}
        {index < pop.comment.split("\n").length - 1 && <br />}
      </div>
    ))}
  </div>
)}
```

## 機能特徴

### できること
- プレーンテキストの入力・表示
- 改行の保持・表示
- 文字数制限によるデータサイズ制御
- リアルタイム文字数表示

### できないこと（現状の制約）
- Markdown などの装飾記法サポートなし
- 文字装飾（太字、斜体、色変更など）なし
- リンクの自動認識・クリック対応なし
- 画像・メディアの埋め込み不可
- 高度なフォーマット機能なし

## 使用場面・用途

### 想定される使用例
- **推薦コメント**: 「このアルバムの3曲目が特におすすめ！」
- **商品説明**: 「限定盤で帯付き、美品です」
- **状態メモ**: 「ジャケットに軽微なスレあり」
- **店員コメント**: 「入荷したばかりの注目作品」
- **お客様向けメッセージ**: 「〜が好きな方におすすめ」

### 表示コンテキスト
- Pop 一覧での商品カード表示
- Visual Editor でのプレビュー表示
- 印刷用テンプレートでの最終出力

## 技術仕様

### データフロー
1. **入力**: CreatePopModal の Textarea
2. **保存**: Pop エンティティの comment プロパティ
3. **表示**: PopCard コンポーネントで条件付きレンダリング

### バリデーション
- 最大文字数: 200文字（maxLength 属性）
- 必須入力: なし
- 特殊文字制限: なし

### スタイリング
- **入力時**: 標準 Textarea スタイル
- **表示時**: 薄いグレー背景（`bg-muted`）、角丸、小さいフォント（`text-xs`）

## 改善可能性・拡張案

### UIの改善
- Markdown サポート（太字、斜体、リスト）
- リッチテキストエディタの導入
- 文字数制限の緩和・調整機能

### 機能拡張
- 定型文・テンプレート機能
- ハッシュタグ機能
- リンク自動検出・プレビュー

### 表示の改善
- コメント折りたたみ機能
- 検索・フィルタリング対応
- コメント別カラーリング

## 既存データ互換性

### 移行対応
- 現在のシンプルテキスト形式は完全に下位互換
- 改行は `\n` で保存され、表示時に `<br />` に変換

### データ保存形式
```typescript
interface PopResponse {
  // ... 他のプロパティ
  comment: string; // プレーンテキスト、改行は \n で保存
}
```

## 関連ファイル

- `/app/components/modal/CreatePopModal.tsx` - 入力UI
- `/app/components/pop/PopCard.tsx` - 表示UI  
- `/src/application/dtos/PopDtos.ts` - データ型定義
- `/src/domain/entities/Pop.ts` - ドメインエンティティ

---

この仕様書は現状のコメント機能を正確に記録し、将来の改善・拡張の検討材料として使用されます。